<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tech Stack Picker • FAQ Accordion</title>
  <style>
    body{font-family:ui-sans-serif,system-ui;background:#f7fbff;margin:0;padding:0;color:#0f1a2b}
    .wrap{max-width:1100px;margin:28px auto;padding:0 18px}
    .card{background:#fff;border:1px solid #dfe8f3;border-radius:16px;box-shadow:0 8px 24px rgba(17, 24, 39, .08);overflow:hidden}
    .hdr{padding:16px 18px;border-bottom:1px solid #dfe8f3}
    .title{font-size:20px;font-weight:800;margin:0}
    .muted{color:#51607a;font-size:14px;margin-top:4px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    input[type="search"],button{border:1px solid #dfe8f3;border-radius:8px;padding:8px 10px;font-size:14px;transition:all 0.2s ease}
    input[type="search"]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
    .flash-message{position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:12px 20px;border-radius:8px;font-weight:600;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transform:translateX(100%);transition:transform 0.3s ease;z-index:1000}
    .flash-message.show{transform:translateX(0)}
    button{cursor:pointer;background:#fff;color:#1e3a8a;font-weight:600;transition:all 0.2s ease;position:relative}
    button:hover:not(:disabled){background:#f1f5f9;border-color:#94a3b8;transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,0.1)}
    button:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    button.primary{background:#3b82f6;color:#fff;border-color:#3b82f6}
    button.primary:hover:not(:disabled){background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,0.3)}
    button.primary:active:not(:disabled){transform:translateY(0);box-shadow:0 2px 6px rgba(59,130,246,0.2)}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .faq{padding:10px}
    details{border:1px solid #dfe8f3;border-radius:12px;background:#fff;margin:8px 0}
    details[open]{background:#e8f1ff}
    summary{cursor:pointer;padding:12px 14px;font-weight:700;display:flex;justify-content:space-between;align-items:center}
    summary::-webkit-details-marker{display:none}
    .pill{font-size:12px;color:#1e3a8a;background:#eef5ff;border:1px solid #dfe8f3;border-radius:999px;padding:2px 8px}
    .grid{display:flex;flex-direction:column;gap:8px;padding:0 14px 14px}
    .chip{display:flex;align-items:flex-start;gap:10px;text-align:left;border:1px solid #dfe8f3;background:#fff;border-radius:8px;padding:12px;font-size:14px;cursor:pointer;transition:all 0.2s ease}
    .chip:hover{background:#f8fafc;border-color:#94a3b8}
    .chip[aria-pressed="true"]{background:#dbeafe;border-color:#3b82f6}
    .chip input[type="checkbox"]{margin:0;width:16px;height:16px;cursor:pointer;accent-color:#3b82f6}
    .chip-content{flex:1}
    .chip strong{display:block;font-weight:700;margin-bottom:4px}
    .chip ul{margin:0;padding-left:16px;color:#51607a;font-size:13px;line-height:1.4}
    .highlight{background-color:#fef08a;padding:1px 2px;border-radius:2px;font-weight:600}
    .go-top{text-align:center;padding:8px 14px;border-top:1px solid #e5e7eb;margin-top:8px}
    .go-top a{color:#3b82f6;text-decoration:none;font-size:13px;font-weight:500}
    .go-top a:hover{text-decoration:underline}
    .footer{padding:12px 18px;border-top:1px solid #dfe8f3;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
    .badge{font-weight:700;color:#0a2d62;background:#dbeafe;border:1px solid #bfdbfe;padding:3px 8px;border-radius:999px;font-size:13px}
    pre{background:#fff;border:1px solid #dfe8f3;border-radius:8px;padding:10px;overflow:auto;max-height:200px;font-size:12px;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hdr">
        <h1 class="title">Tech Stack Picker</h1>
        <p class="muted">FAQ-style accordion • tap items to select • light blue / dark blue / off-white theme</p>
        <div class="controls">
          <input id="search" type="search" placeholder="Search items…" />
          <button id="expandAll">Expand all</button>
          <button id="collapseAll">Collapse all</button>
          <button id="reset">Reset</button>
          <button id="exportJson" class="primary">Export JSON</button>
          <button id="copyJson">Copy JSON</button>
          <button id="exportCsv">Export CSV</button>
          <button id="copyMd">Copy Markdown</button>
        </div>
      </div>
      <div class="faq" id="faq"></div>
      <div class="footer">
        <span class="badge" id="count">0 selected</span>
        <span class="muted" id="status">No package yet.</span>
      </div>
      <pre id="preview"></pre>
    </div>
  </div>
<script>
// Data from your tech stack
const DATA = [
  {
    "title": "AI / Automation — Smart workflow engines",
    "items": [
      {
        "name": "Custom GPTs",
        "bullets": [
          "Repetitive decisions → consistent auto-rules",
          "Scattered processes → unified workflows",
          "Staff overload → AI co-pilot"
        ]
      },
      {
        "name": "[OpenAI (Assistants, Whisper, ChatGPT)](https://openai.com)",
        "bullets": [
          "Untranscribed calls → accurate transcripts",
          "Blank page syndrome → instant drafts",
          "Slow responses → AI assistance"
        ]
      },
      {
        "name": "[Make.com](https://www.make.com)",
        "bullets": [
          "Manual copy-paste → hands-free syncing",
          "Missed follow-ups → scheduled automations",
          "Entry errors → validated transfers"
        ]
      },
      {
        "name": "[Pipedream](https://pipedream.com)",
        "bullets": [
          "Event chaos → trigger-based flows",
          "API gaps → custom connectors",
          "Slow reactions → real-time handlers"
        ]
      },
      {
        "name": "[IFTTT](https://ifttt.com)",
        "bullets": [
          "Disconnected apps → simple bridges",
          "Forgotten routines → set-and-forget rules",
          "Device silos → unified triggers"
        ]
      }
    ]
  },
  {
    "title": "Voice / Telephony / Messaging — Scalable communications",
    "items": [
      {
        "name": "[Twilio](https://www.twilio.com)",
        "bullets": [
          "No-shows → automated reminders",
          "Slow outreach → bulk SMS/voice",
          "Tiny team → programmable comms"
        ]
      },
      {
        "name": "Bria",
        "bullets": [
          "Deskbound calling → mobile softphone",
          "Inconsistent caller ID → pro presence",
          "Scattered devices → one client"
        ]
      },
      {
        "name": "[OpenPhone](https://www.openphone.com)",
        "bullets": [
          "Personal number use → business line",
          "Missed texts → shared inbox",
          "Untracked calls → CRM notes"
        ]
      },
      {
        "name": "[Vapi.ai](https://www.vapi.ai)",
        "bullets": [
          "Missed calls → 24/7 AI answer",
          "Uneven intake → scripted flows",
          "Lead leakage → instant triage"
        ]
      },
      {
        "name": "[Retell.ai](https://www.retell.ai)",
        "bullets": [
          "Inconsistent pitches → scripted agents",
          "Limited staff hours → always-on calls",
          "Training time → deployable bots"
        ]
      },
      {
        "name": "[Textline](https://www.textline.com)",
        "bullets": [
          "Slow email chains → fast SMS",
          "Lost threads → CRM-synced texts",
          "Channel friction → native messaging"
        ]
      },
      {
        "name": "WhatsApp / Messenger",
        "bullets": [
          "Customer drop-off → preferred channels",
          "Plain text only → rich media replies",
          "Trust gap → verified profiles"
        ]
      }
    ]
  },
  {
    "title": "Web / Digital Presence — Findable modern sites",
    "items": [
      {
        "name": "SEO",
        "bullets": [
          "Invisible pages → keyword wins",
          "Low local reach → map pack boosts",
          "Thin snippets → rich metadata"
        ]
      },
      {
        "name": "[Google Business Listing / Reviews](https://www.google.com/business)",
        "bullets": [
          "Low map visibility → profile optimization",
          "Few reviews → request workflows",
          "Unanswered Q&A → managed responses"
        ]
      },
      {
        "name": "[WordPress](https://wordpress.org)",
        "bullets": [
          "Stale site → easy updates",
          "DIY look → pro themes",
          "Plugin sprawl → curated stack"
        ]
      },
      {
        "name": "Next.js / Astro",
        "bullets": [
          "Slow loads → blazing SSR/SSG",
          "Poor Core Web Vitals → optimized build",
          "Mobile friction → responsive by default"
        ]
      },
      {
        "name": "HTML/CSS/JS",
        "bullets": [
          "One-size SaaS → custom UX",
          "Locked features → full control",
          "Monthly fees → own your code"
        ]
      },
      {
        "name": "Misc Webforms",
        "bullets": [
          "Unqualified leads → smart forms",
          "Data re-entry → direct capture",
          "Unknown intent → conditional logic"
        ]
      },
      {
        "name": "QR Codes",
        "bullets": [
          "Paper dead ends → instant links",
          "Confusing signage → scannable actions",
          "Slow onboarding → quick access"
        ]
      },
      {
        "name": "[YouTube](https://www.youtube.com)",
        "bullets": [
          "Low trust → proof by video",
          "Cold traffic → helpful demos",
          "SEO plateau → video rankings"
        ]
      }
    ]
  },
  {
    "title": "Data / Storage / Productivity — Centralized work hub",
    "items": [
      {
        "name": "[Airtable](https://airtable.com)",
        "bullets": [
          "Scattered spreadsheets → one source",
          "Manual status checks → filtered views",
          "Guesswork → rollup dashboards"
        ]
      },
      {
        "name": "[Notion](https://www.notion.so)",
        "bullets": [
          "Docs everywhere → single workspace",
          "Team drift → shared pages",
          "Lost SOPs → living wiki"
        ]
      },
      {
        "name": "[Google Drive](https://www.google.com/drive)",
        "bullets": [
          "File chaos → structured folders",
          "Version confusion → real-time edits",
          "Local-only files → cloud access"
        ]
      },
      {
        "name": "[JotForm](https://www.jotform.com)",
        "bullets": [
          "Paper intake → online forms",
          "Manual typing → auto-sync",
          "Slow approvals → routed steps"
        ]
      },
      {
        "name": "[Google Maps / Embedded Map](https://maps.google.com)",
        "bullets": [
          "Hard-to-find office → accurate pin",
          "Inefficient routes → smart planning",
          "Service delays → ETA sharing"
        ]
      },
      {
        "name": "[Google Photos](https://photos.google.com)",
        "bullets": [
          "Lost job photos → organized albums",
          "No proof-of-work → timestamped logs",
          "Warranty disputes → visual records"
        ]
      },
      {
        "name": "[Diarium](https://www.diariumapp.com)",
        "bullets": [
          "Forgotten wins → daily journal",
          "Unclear patterns → tag insights",
          "Scattered notes → unified log"
        ]
      },
      {
        "name": "[Dropbox](https://www.dropbox.com)",
        "bullets": [
          "Emailing files → shared links",
          "Device mismatch → sync everywhere",
          "Large transfers → reliable delivery"
        ]
      },
      {
        "name": "[Evernote](https://www.evernote.com)",
        "bullets": [
          "Sticky notes → searchable vault",
          "Project clutter → notebooks & tags",
          "Idea loss → quick capture"
        ]
      }
    ]
  },
  {
    "title": "Finance / Payments — Faster accurate money",
    "items": [
      {
        "name": "[QuickBooks Online](https://quickbooks.intuit.com)",
        "bullets": [
          "Messy books → clean ledgers",
          "Tax panic → ready reports",
          "Unknown margins → live P&L"
        ]
      },
      {
        "name": "[Stripe](https://stripe.com)",
        "bullets": [
          "Slow invoices → instant pay links",
          "Dunning churn → smart retries",
          "One-time only → subscriptions"
        ]
      },
      {
        "name": "[PayPal](https://www.paypal.com)",
        "bullets": [
          "Buyer hesitation → trusted checkout",
          "Cross-border issues → global reach",
          "Cash flow gaps → quick settlements"
        ]
      },
      {
        "name": "Cash App / Zelle",
        "bullets": [
          "Waiting on checks → instant P2P",
          "Fees shock → low/no-cost options",
          "Small transfers → simple requests"
        ]
      },
      {
        "name": "Online Banking / Hand Checking",
        "bullets": [
          "Blind cash flow → real-time balances",
          "Fraud risk → alerts & limits",
          "Untracked spend → categorized feeds"
        ]
      }
    ]
  },
  {
    "title": "Security / Access — Identity and secrets",
    "items": [
      {
        "name": "[RoboForm](https://www.roboform.com)",
        "bullets": [
          "Shared passwords → secure vault",
          "Weak creds → strong generators",
          "Offboarding gaps → revoke access"
        ]
      },
      {
        "name": "Clear Token",
        "bullets": [
          "Single-factor logins → 2FA enforced",
          "Account takeovers → step-up auth",
          "Access sprawl → centralized control"
        ]
      }
    ]
  },
  {
    "title": "Media / Content — Learn and share",
    "items": [
      {
        "name": "[Pocket Casts](https://pocketcasts.com)",
        "bullets": [
          "Falling behind → curated shows",
          "Idle time → on-the-go learning",
          "Info overload → smart playlists"
        ]
      },
      {
        "name": "[Alexa](https://www.amazon.com/alexa)",
        "bullets": [
          "Hands busy → voice commands",
          "Slow lookups → instant answers",
          "Office friction → routine automations"
        ]
      }
    ]
  },
  {
    "title": "Remote Access / Surveillance — Remote control and eyes",
    "items": [
      {
        "name": "[RustDesk](https://rustdesk.com)",
        "bullets": [
          "On-site fixes → remote support",
          "Travel costs → zero-visit help",
          "File hurdles → secure transfer"
        ]
      },
      {
        "name": "[Blue Iris](https://blueirissoftware.com)",
        "bullets": [
          "Unverified incidents → recorded proof",
          "Theft risk → smart alerts",
          "Blind spots → multi-cam monitoring"
        ]
      }
    ]
  },
  {
    "title": "Development / Tools — Build and ship",
    "items": [
      {
        "name": "[FileZilla](https://filezilla-project.org)",
        "bullets": [
          "Risky edits → safe transfers",
          "No backups → quick restores",
          "Slow updates → batch deploys"
        ]
      },
      {
        "name": "[MySQL](https://www.mysql.com)",
        "bullets": [
          "Spreadsheet limits → real database",
          "Slow queries → indexed speed",
          "Data growth → scalable storage"
        ]
      },
      {
        "name": "[PowerShell](https://microsoft.com/powershell)",
        "bullets": [
          "Manual admin → scripted tasks",
          "One-by-one fixes → bulk actions",
          "Human error → repeatable runs"
        ]
      },
      {
        "name": "[AutoHotkey](https://www.autohotkey.com)",
        "bullets": [
          "Click fatigue → hotkey macros",
          "Slow workflows → automation",
          "UI-only apps → scripted control"
        ]
      },
      {
        "name": "VBA in Google Sheets & Docs",
        "bullets": [
          "Manual math → coded logic",
          "Copy errors → functions & checks",
          "One-off reports → reusable scripts"
        ]
      },
      {
        "name": "[Cursor IDE](https://www.cursor.com)",
        "bullets": [
          "Coding stalls → AI suggestions",
          "Boilerplate time → quick scaffolds",
          "Review lag → inline feedback"
        ]
      }
    ]
  },
  {
    "title": "Mapping / Routing — Efficient routes",
    "items": [
      {
        "name": "Routing Software (Distance/Time/ETA)",
        "bullets": [
          "Wasted miles → optimized paths",
          "Late arrivals → accurate ETAs",
          "Fuel burn → smarter sequencing"
        ]
      }
    ]
  },
  {
    "title": "Scheduling / Communication — Time and team sync",
    "items": [
      {
        "name": "[Google Calendar](https://calendar.google.com)",
        "bullets": [
          "Double-bookings → shared calendars",
          "No-shows → auto reminders",
          "Timezone misses → smart invites"
        ]
      },
      {
        "name": "[Discord](https://discord.com)",
        "bullets": [
          "Scattered chats → team hub",
          "Meeting friction → voice rooms",
          "Remote drift → always-on comms"
        ]
      }
    ]
  },
  {
    "title": "Document & File Processing — Paper to data",
    "items": [
      {
        "name": "OCR",
        "bullets": [
          "Unsearchable scans → indexed text",
          "Manual retyping → auto extract",
          "Lost info → full-text find"
        ]
      },
      {
        "name": "Scanning (Receipts, Invoices, etc.)",
        "bullets": [
          "Paper piles → digital archive",
          "Missing receipts → captured images",
          "Audit stress → organized records"
        ]
      },
      {
        "name": "Automated File Naming/Filing",
        "bullets": [
          "Random filenames → rules-based names",
          "Lost docs → auto folders",
          "Slow retrieval → predictable paths"
        ]
      },
      {
        "name": "Barcode File Labeling",
        "bullets": [
          "Inventory guesswork → scannable IDs",
          "Mismatched items → linked records",
          "Count errors → quick scans"
        ]
      },
      {
        "name": "Forms Routing / Approval",
        "bullets": [
          "Stalled requests → tracked steps",
          "Email backlogs → workflow queues",
          "Unclear owners → assigned approvers"
        ]
      },
      {
        "name": "Dashboards",
        "bullets": [
          "Blind spots → KPI visibility",
          "Slow decisions → live metrics",
          "Surprises → early alerts"
        ]
      },
      {
        "name": "Chatbot",
        "bullets": [
          "After-hours silence → 24/7 answers",
          "Unqualified leads → guided intake",
          "Repetitive FAQs → instant replies"
        ]
      }
    ]
  }
]
;

const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

// Persist selections - Using in-memory storage
let state = {};

function render(){
  try {
    console.log('Starting render...');
    const faq = document.getElementById('faq');
    if (!faq) {
      console.error('FAQ container not found!');
      return;
    }
    
    faq.innerHTML = '';
    
    DATA.forEach(cat => {
      const catId = slug(cat.title);
      const d = document.createElement('details');
      d.className = 'cat';
      d.id = `cat-${catId}`;
      d.open = false;

      const selected = (state[catId]||[]).length;
      d.innerHTML = `
        <summary>
          <span>${cat.title}</span>
          <span class="pill" title="Selected in this category">${selected}/${cat.items.length}</span>
        </summary>
        <div class="grid"></div>
      `;

      const grid = d.querySelector('.grid');
cat.items.forEach(it => {
  const key = slug(it.name);
  const pressed = (state[catId]||[]).includes(key);
  const el = document.createElement('label');
  el.className = 'chip';
  el.setAttribute('aria-pressed', pressed);
  el.dataset.cat = catId;
  el.dataset.key = key;

  // Detect Markdown link pattern [text](url) and render clickable link
  let linkHtml = '';
  const match = it.name.match(/^\[(.+?)\]\((https?:\/\/[^\s]+)\)$/);
  if (match) {
linkHtml = `<a href="${match[2]}" target="_blank" rel="noopener noreferrer">${match[1]}</a>`;

  } else {
    linkHtml = it.name;
  }

  el.innerHTML = `
    <input type="checkbox" ${pressed ? 'checked' : ''}>
    <div class="chip-content">
      <strong>${linkHtml}</strong>
      <ul>${it.bullets.map(b => `<li>${b}</li>`).join('')}</ul>
    </div>
  `;
  grid.appendChild(el);
});
		


      // Add "Go to top" link
      const goTop = document.createElement('div');
      goTop.className = 'go-top';
      goTop.innerHTML = '<a href="#" onclick="window.scrollTo({top:0,behavior:\'smooth\'});return false;">↑ Go to top</a>';
      d.appendChild(goTop);

      faq.appendChild(d);
    });

    console.log('Render complete, binding events...');
    bind();
    updatePreview();
    console.log('All done!');
  } catch (error) {
    console.error('Error in render:', error);
  }
}

function bind(){
  try {
    // Toggle selection by clicking chip or checkbox
    const allChips = document.querySelectorAll('#faq .chip');
    for(let i = 0; i < allChips.length; i++){
      const label = allChips[i];
      label.addEventListener('click', function(e) {
        // Prevent double-firing when clicking checkbox directly
        if(e.target.type === 'checkbox') return;
        
        const checkbox = label.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        toggleSelection(label, checkbox.checked);
      });
      
      // Handle direct checkbox clicks
      const checkbox = label.querySelector('input[type="checkbox"]');
      checkbox.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleSelection(label, e.target.checked);
      });
    }
  } catch (error) {
    console.error('Error in bind:', error);
  }
}

function toggleSelection(label, isChecked) {
  const cat = label.dataset.cat;
  const key = label.dataset.key;
  state[cat] = state[cat] || [];
  const i = state[cat].indexOf(key);
  
  if(isChecked && i === -1) {
    state[cat].push(key);
  } else if(!isChecked && i !== -1) {
    state[cat].splice(i, 1);
  }
  
  label.setAttribute('aria-pressed', isChecked);
  
  // Update the pill counter for this category
  updateCategoryPill(cat);
  updatePreview();
}

function updateCategoryPill(catId) {
  const categoryElement = document.querySelector(`#cat-${catId}`);
  if (categoryElement) {
    const pill = categoryElement.querySelector('.pill');
    const catObj = DATA.find(c => slug(c.title) === catId);
    const selectedCount = (state[catId] || []).length;
    pill.textContent = `${selectedCount}/${catObj.items.length}`;
  }
}

// Simple search - no highlighting for now
document.getElementById('search').addEventListener('input', function(e) {
  const query = e.target.value.trim().toLowerCase();
  console.log('Searching for:', query);
  
  const allChips = document.querySelectorAll('.chip');
  const allDetails = document.querySelectorAll('details');
  
  if(query === '') {
    for(let i = 0; i < allChips.length; i++) {
      allChips[i].style.display = '';
    }
    for(let i = 0; i < allDetails.length; i++) {
      allDetails[i].style.display = '';
    }
    return;
  }
  
  // Expand all when searching
  for(let i = 0; i < allDetails.length; i++) {
    allDetails[i].open = true;
  }
  
  let totalMatches = 0;
  
  for(let i = 0; i < allDetails.length; i++) {
    const categoryDetails = allDetails[i];
    let categoryHasMatches = false;
    
    const chipsInCategory = categoryDetails.querySelectorAll('.chip');
    for(let j = 0; j < chipsInCategory.length; j++) {
      const chip = chipsInCategory[j];
      const text = chip.textContent.toLowerCase();
      
      if(text.includes(query)) {
        chip.style.display = '';
        categoryHasMatches = true;
        totalMatches++;
      } else {
        chip.style.display = 'none';
      }
    }
    
    categoryDetails.style.display = categoryHasMatches ? '' : 'none';
  }
  
  console.log('Found', totalMatches, 'matches');
});

// Button events
document.getElementById('expandAll').addEventListener('click', function(){
  const allDetails = document.querySelectorAll('#faq details');
  for(let i = 0; i < allDetails.length; i++) {
    allDetails[i].open = true;
  }
});

document.getElementById('collapseAll').addEventListener('click', function(){
  const allDetails = document.querySelectorAll('#faq details');
  for(let i = 0; i < allDetails.length; i++) {
    allDetails[i].open = false;
  }
});

document.getElementById('reset').addEventListener('click', function(){
  for(const k in state) delete state[k]; 
  render(); 
});

function gather(){
  const out = [];
  DATA.forEach(cat=>{
    const picked = (state[slug(cat.title)]||[]);
    if(!picked.length) return;
    out.push({
      category: cat.title,
      items: cat.items.filter(it=>picked.includes(slug(it.name))).map(it=>({ name: it.name, bullets: it.bullets }))
    });
  });
  return out;
}

function toCSV(selection){
  const rows = [['category','name','bullets']];
  selection.forEach(cat=>cat.items.forEach(it=>rows.push([cat.category,it.name,it.bullets.join(' | ')])));
  return rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
}

function toMarkdown(selection){
  let md = '# Product Package\n\n';
  selection.forEach(cat=>{
    md += `## ${cat.category}\n`;
    cat.items.forEach(it=>{ md += `- **${it.name}**\n`; it.bullets.forEach(b=> md += `  - ${b}\n`); });
    md += '\n';
  });
  return md;
}

function updatePreview(){
  const selection = gather();
  const json = JSON.stringify({ id:`product-${Date.now()}`, created_at:new Date().toISOString(), selection }, null, 2);
  document.getElementById('preview').textContent = json;
  const total = selection.reduce((n,c)=>n+c.items.length,0);
  document.getElementById('count').textContent = `${total} selected`;
  document.getElementById('status').textContent = total? 'Ready to export.' : 'No package yet.';
  const disabled = total===0;
  const buttons = ['exportJson','copyJson','exportCsv','copyMd'];
  for(let i = 0; i < buttons.length; i++) {
    document.getElementById(buttons[i]).disabled = disabled;
  }
}

function showFlashMessage(message) {
  const existing = document.querySelector('.flash-message');
  if(existing) existing.remove();
  
  const flash = document.createElement('div');
  flash.className = 'flash-message';
  flash.textContent = message;
  document.body.appendChild(flash);
  
  setTimeout(() => flash.classList.add('show'), 10);
  setTimeout(() => {
    flash.classList.remove('show');
    setTimeout(() => flash.remove(), 300);
  }, 2000);
}

function download(filename, content, type){
  const blob = new Blob([content], {type});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  URL.revokeObjectURL(a.href);
  a.remove();
}

// Export functions
document.getElementById('exportJson').addEventListener('click', function(){
  const selection = gather();
  const payload = { id:`product-${new Date().toISOString().replace(/[^0-9]/g,'')}`, created_at:new Date().toISOString(), selection };
  download(`${payload.id}.json`, JSON.stringify(payload, null, 2), 'application/json');
  showFlashMessage('JSON file exported!');
});

document.getElementById('copyJson').addEventListener('click', function(){
  const selection = gather();
  const payload = { id:`product-${new Date().toISOString().replace(/[^0-9]/g,'')}`, created_at:new Date().toISOString(), selection };
  const json = JSON.stringify(payload, null, 2);
  navigator.clipboard.writeText(json).then(function() {
    showFlashMessage('JSON copied to clipboard!');
  }).catch(function() {
    showFlashMessage('Failed to copy JSON');
  });
});

document.getElementById('exportCsv').addEventListener('click', function(){
  const selection = gather();
  if(selection.length === 0) return;
  download(`product-${Date.now()}.csv`, toCSV(selection), 'text/csv');
  showFlashMessage('CSV file exported!');
});

document.getElementById('copyMd').addEventListener('click', function(){
  const selection = gather();
  if(selection.length === 0) return;
  const md = toMarkdown(selection);
  navigator.clipboard.writeText(md).then(function() {
    showFlashMessage('Markdown copied to clipboard!');
  }).catch(function() {
    showFlashMessage('Failed to copy Markdown');
  });
});

// Initialize the app
console.log('Initializing app...');
render();
</script>
</body>
</html>